<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>CI/CD 小遊戲 — 交作業</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:ui-sans-serif,system-ui;max-width:560px;margin:40px auto;padding:0 12px}
    h1{font-size:22px;margin-bottom:8px}
    p{color:#555}
    input,button{font-size:16px;padding:10px}
    .row{display:flex;gap:8px}
    .msg{margin-top:16px;min-height:24px}
  </style>
</head>
<body>
  <h1>CI/CD 小遊戲：交作業</h1>
  <p>輸入學號送出，系統會在本 repo 建立一個 PR，第一個被老師<b>手動部屬</b>上 Cloud Run 的同學獲獎！</p>

  <div class="row">
    <input id="sid" placeholder="學號（9位數字）" />
    <button id="send">送出</button>
  </div>
  <div class="msg" id="msg"></div>

  <script>
    const btn = document.getElementById('send');
    const sid = document.getElementById('sid');
    const msg = document.getElementById('msg');

    btn.onclick = async () => {
      const v = sid.value.trim();
      if (!/^\d{9}$/.test(v)) { msg.textContent = '請輸入正確學號（9位數字）'; return; }

      msg.textContent = '送出中…';
      try {
        const r = await fetch('/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ studentId: v })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || '未知錯誤');
        msg.innerHTML = `成功！已建立 PR：<a target="_blank" href="${data.pr_url}">${data.pr_url}</a>（分支：${data.branch}）`;
      } catch (e) {
        msg.textContent = '失敗：' + e.message;
      }
    }
  </script>
</body>
</html>
