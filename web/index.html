<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>CI/CD 小遊戲 — 交作業</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:ui-sans-serif,system-ui;max-width:560px;margin:40px auto;padding:0 12px}
    h1{font-size:1.6rem;margin-bottom:6px}
    p{color:#555}
    input,button{font-size:16px;padding:10px}
    .row{display:flex;gap:8px}
    .msg{margin-top:16px;min-height:24px}
  </style>
</head>
<body>
  <h1>CI/CD 小遊戲：交作業</h1>
  <p>輸入學號後送出，系統會在本 repo 建立一個 PR。第一個被老師 <b>手動部署</b> 上 Cloud Run 的同學獲獎！</p>

  <div class="row">
    <input id="sid" placeholder="學號 (8~10位數字)" />
    <button id="send">送出</button>
  </div>
  <div class="msg" id="msg"></div>

  <script>
    const btn = document.getElementById('send');
    const sid = document.getElementById('sid');
    const msg = document.getElementById('msg');

    btn.onclick = async () => {
      const v = sid.value.trim();
      if (!/^\d{8,10}$/.test(v)) { msg.textContent = '請輸入正確學號（8~10位數字）'; return; }
      btn.disabled = true; msg.textContent = '送出中...';
      try {
        const r = await fetch('https://cicdgame-423035020857.europe-west1.run.app/submit', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ studentId: v })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || '提交失敗');
        msg.innerHTML = `成功！你的 PR：<a href="${data.pr_url}" target="_blank">打開連結</a>`;
      } catch(e){ msg.textContent = '錯誤：' + e.message; }
      finally { btn.disabled = false; }
    };
  </script>
</body>
</html>